# ğŸš€ HuggingFaceæµå¼æ•°æ®åŠ è½½é…ç½® - å·¥ä¸šç•Œæœ€ä½³å®è·µ
# è¾¹ä¸‹è¾¹è®­ï¼Œå†…å­˜å ç”¨æå°ï¼Œæ”¯æŒæ— é™å¤§æ•°æ®é›†

model:
  hidden_size: 768
  intermediate_size: 2048
  num_hidden_layers: 12
  num_attention_heads: 12
  num_key_value_heads: 12
  vocab_size: 50257        # GPT2åˆ†è¯å™¨è¯æ±‡è¡¨å¤§å°
  max_position_embeddings: 2048
  window_size: 1024        # å®é™…ä½¿ç”¨çš„ä¸Šä¸‹æ–‡é•¿åº¦
  rms_norm_eps: 1e-06
  tie_word_embeddings: false
  drop_branch_prob: 0.1    # åˆ†æ”¯éšæœºä¸¢å¼ƒæ¦‚ç‡
  
  # Mambaé…ç½®
  mamba_config:
    state_size: 16
    conv_kernel: 4
    expand_factor: 2

training:
  max_steps: 5000          # æµå¼è®­ç»ƒï¼šå¯ä»¥è®¾ç½®æ›´å¤§çš„æ­¥æ•°
  warmup_steps: 500
  learning_rate: 3e-4
  weight_decay: 0.1
  beta1: 0.9
  beta2: 0.95
  eps: 1e-8
  max_grad_norm: 1.0
  
  # æ‰¹æ¬¡é…ç½®
  batch_size: 4            # æ¯GPUæ‰¹æ¬¡å¤§å°
  gradient_accumulation_steps: 4
  max_seq_length: 1024
  
  # æ··åˆç²¾åº¦
  fp16: false
  bf16: true

data:
  # ğŸ”¥ æ¨¡å¼1ï¼šä½¿ç”¨é¢„è®¾çš„æ•°æ®æ··åˆ
  data_mode: hf_streaming
  hf_preset: wikipedia_only    # wikipedia_only|english_mix|multilingual_mix
  
  # ğŸ”¥ æ¨¡å¼2ï¼šè‡ªå®šä¹‰æ•°æ®æºé…ç½®ï¼ˆæ³¨é‡Šæ‰ä¸Šé¢çš„hf_presetåå¯ç”¨ï¼‰
  # hf_streaming_sources:
  #   - name: "wikimedia/wikipedia"
  #     config: "20231101.en"
  #     split: "train"
  #     text_key: "text"
  #     weight: 1.0
  #   - name: "Skylion007/openwebtext"
  #     split: "train"
  #     text_key: "text"
  #     weight: 1.5
  
  # æ•°æ®å¤„ç†é…ç½®
  tokenizer_path: "gpt2"
  max_length: 1024
  min_length: 50
  concat_docs: true          # âœ… å¯ç”¨tokençº§æ‰“åŒ…
  add_special_tokens: true
  document_separator: "\n\n"
  
  # æµå¼ä¼˜åŒ–é…ç½®
  shuffle_buffer_size: 10000
  trust_remote_code: false
  num_workers: 0             # æµå¼æ¨¡å¼æ¨è0
  pin_memory: true
  seed: 42

system:
  use_deepspeed: true
  zero_stage: 2
  offload_optimizer: false   # ZeRO-2å…³é—­offloadé¿å…å¡é¡¿
  offload_params: false
  
  # åˆ†å¸ƒå¼é…ç½®
  find_unused_parameters: false

logging:
  log_interval: 25
  save_interval: 1000        # æµå¼è®­ç»ƒï¼šå¯ä»¥è®¾ç½®æ›´å¤§çš„ä¿å­˜é—´éš”
  eval_interval: 500
  project_name: "FusionTree-HF-Streaming"
  experiment_name: "wikipedia-streaming-test"
  use_wandb: false 