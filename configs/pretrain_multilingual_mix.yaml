# ğŸŒ å¤šè¯­è¨€å¤šæ•°æ®æºæ··åˆè®­ç»ƒé…ç½®
# å±•ç¤ºHFæµå¼åŠ è½½çš„å¼ºå¤§æ··åˆèƒ½åŠ›

model:
  hidden_size: 768
  intermediate_size: 2048
  num_hidden_layers: 12
  num_attention_heads: 12
  num_key_value_heads: 12
  vocab_size: 50257        # GPT2åˆ†è¯å™¨ï¼ˆå¯è€ƒè™‘æ¢æˆå¤šè¯­è¨€åˆ†è¯å™¨ï¼‰
  max_position_embeddings: 2048
  window_size: 1024
  rms_norm_eps: 1e-06
  tie_word_embeddings: false
  drop_branch_prob: 0.1
  
  mamba_config:
    state_size: 16
    conv_kernel: 4
    expand_factor: 2

training:
  max_steps: 10000         # æ›´å¤§çš„æ•°æ®é›†éœ€è¦æ›´å¤šæ­¥æ•°
  warmup_steps: 1000
  learning_rate: 2e-4      # å¤šæºæ•°æ®å¯ä»¥ç”¨ç¨å°çš„å­¦ä¹ ç‡
  weight_decay: 0.1
  beta1: 0.9
  beta2: 0.95
  eps: 1e-8
  max_grad_norm: 1.0
  
  batch_size: 4
  gradient_accumulation_steps: 4
  max_seq_length: 1024
  
  fp16: false
  bf16: true

data:
  # ğŸ”¥ å¤šæ•°æ®æºæŒ‰æƒé‡æ··åˆ
  data_mode: hf_streaming
  hf_streaming_sources:
    # è‹±æ–‡ç»´åŸºç™¾ç§‘ - åŸºç¡€æƒé‡
    - name: "wikimedia/wikipedia"
      config: "20231101.en"
      split: "train"
      text_key: "text"
      weight: 1.0
    
    # ä¸­æ–‡ç»´åŸºç™¾ç§‘ - è¾ƒå°æƒé‡
    - name: "wikimedia/wikipedia"
      config: "20231101.zh"
      split: "train"
      text_key: "text"
      weight: 0.3
      
    # OpenWebText - æ›´å¤§æƒé‡ï¼ˆç½‘ç»œæ–‡æœ¬ï¼‰
    - name: "Skylion007/openwebtext"
      split: "train"
      text_key: "text"
      weight: 1.5
      
    # C4è‹±æ–‡ - è¡¥å……çš„æ¸…æ´—ç½‘ç»œæ–‡æœ¬
    - name: "c4"
      config: "en"
      split: "train"
      text_key: "text"
      weight: 0.8
  
  # æ•°æ®å¤„ç†é…ç½®
  tokenizer_path: "gpt2"
  max_length: 1024
  min_length: 100          # å¤šæºæ··åˆæ—¶ç”¨æ›´ä¸¥æ ¼çš„è¿‡æ»¤
  concat_docs: true
  add_special_tokens: true
  document_separator: "\n\n"
  
  # æµå¼ä¼˜åŒ–
  shuffle_buffer_size: 20000  # æ›´å¤§çš„shuffle buffer
  trust_remote_code: false
  num_workers: 0
  pin_memory: true
  seed: 42

system:
  use_deepspeed: true
  zero_stage: 2
  offload_optimizer: false
  offload_params: false
  find_unused_parameters: false

logging:
  log_interval: 50
  save_interval: 2000      # å¤§æ•°æ®é›†ä¿å­˜é—´éš”å¯ä»¥æ›´å¤§
  eval_interval: 1000
  project_name: "FusionTree-Multilingual"
  experiment_name: "wikipedia-owt-c4-mix"
  use_wandb: false 